# <img src="https://lab.ssafy.com/s10-webmobile1-sub2/S10P12A303/-/raw/CocoisCat-master-patch-77607/IMG/ieum_logo.png" width="60" height="50"> IEUM
독거노인을 위한 인공지능 스피커 "이음"
<br>

## 👩‍👩‍👧‍👦 팀원 소개
<div align="center">

| **김영욱-팀장**<br>BE, IOT | **강다솔-팀원**<br>BE, FE | **서다찬-팀원**<br>BE, FE | **이성목-팀원**<br>BE, IOT | **우혁-팀원**<br>FE | **장태수-팀원**<br>FE |
| :------: |  :------: | :------: | :------: | :------: | :------: |
| [<img src="https://lab.ssafy.com/s10-webmobile1-sub2/S10P12A303/-/raw/CocoisCat-master-patch-77607/IMG/kim.png?ref_type=heads" height=150 width=150> <br/> @dmnion](https://lab.ssafy.com/dmnion) | [<img src="https://lab.ssafy.com/s10-webmobile1-sub2/S10P12A303/-/raw/CocoisCat-master-patch-77607/IMG/kang.jpeg?ref_type=heads" height=150 width=150> <br/> @dasol199](https://lab.ssafy.com/dasol199) | [<img src="https://lab.ssafy.com/s10-webmobile1-sub2/S10P12A303/-/raw/CocoisCat-master-patch-77607/IMG/seo.jpeg?ref_type=heads" height=150 width=150> <br/> @chn7894](https://lab.ssafy.com/chn7894) | [<img src="https://lab.ssafy.com/s10-webmobile1-sub2/S10P12A303/-/raw/CocoisCat-master-patch-77607/IMG/lee.jpeg?ref_type=heads" height=150 width=150> <br/> @CocoisCat](https://lab.ssafy.com/CocoisCat) | [<img src="https://lab.ssafy.com/s10-webmobile1-sub2/S10P12A303/-/raw/CocoisCat-master-patch-77607/IMG/woo.jpeg?ref_type=heads" height=150 width=150> <br/> @dngur12kr](https://lab.ssafy.com/dngur12kr) | [<img src="https://lab.ssafy.com/s10-webmobile1-sub2/S10P12A303/-/raw/CocoisCat-master-patch-77607/IMG/jang.jpeg?ref_type=heads" height=150 width=150> <br/> @use02042](https://lab.ssafy.com/use02042) |

</div>


<br>

## 📝 프로젝트 개요 
* <strong>진행 기간</strong>: 2024.01.03 ~ 2024.02.16
* <strong>목표</strong>
  * 독거노인과 이음이가 상호 소통함으로써 독거노인의 외로움을 덜어줄 수 있다
  * 리마인드 기능을 통해 독거노인의 식사, 일정, 약 복용, 취침 등 일상 생활에 도움을 줄 수 있다
  * 영상 통화를 기능을 통해 독거노인과 소통할 수 있다
  * 보호자는 웹 서비스를 통해 독거노인의 활동 상태를 모니터링 할 수 있다
<br>


## ✍️ 프로젝트 소개 
<strong>IEUM</strong>은 독거노인을 위한 AI 스피커입니다.

이음이는 대화형 인공지능을 탑재하여 독거노인의 말동무가 되어줄 수 있습니다.<br>
관리자가 이음이의 최근 사용 내역을 통해 독거노인의 상태를 모니터링할 수 있습니다.

이음이는 식사 알림, 일정 알림, 기념일 알림, 취침 알림, 약 복용 알림 등의 기능을 탑재하여 독거노인의 일상생활에 도움을 줄 수 있습니다.<br>

<strong>IEUM</strong>을 통해 독거노인의 생활에 도움을 주고자 합니다.

<br>

## 💡 주요 기능 
### ChatGPT 기반의 대화형 인공지능 탑재
> ChatGPT 기반의 10살 지능을 가진 대화형 인공지능을 활용하여 독거노인의 말동무가 되어줄 수 있습니다

![login](https://user-images.githubusercontent.com/24693833/130022798-22acb98e-9ebe-4562-b822-4195be7aadee.gif)


* 게임 모드를 선택하고, 닉네임을 입력하면 방을 생성할 수 있습니다
* 방장은 url을 통해 친구를 초대할 수 있습니다.

![방생성](https://user-images.githubusercontent.com/24693833/130015175-ff85bc5c-0f4e-42f6-817b-829de97fe6d4.gif)



### 알림 기능
> 

![talk](https://user-images.githubusercontent.com/24693833/130020919-064a61f6-0310-4232-bb2a-83925dee8616.gif)


- 동시에 말할 때 헷갈리지 않도록 현재 말하는 사람이 누구인지 표시됩니다.

### 독거노인의 상태 모니터링
> 화재 알림, 최근 사용 내역

### WebRTC를 활용한 영상통화

> 실제 친구들과 모여서 하던 것처럼 말하고, 투표하고, 정치할 수 있습니다.
- webSocket을 이용해 마피아 게임 기능을 구현했습니다.

![밤-마피아](https://user-images.githubusercontent.com/24693833/130020764-76ea2d8f-9ee4-41d7-9b78-964c0a36f31c.gif)


- 밤에 마피아들은 고개를 들어 누굴 제거할 지 고민했던 것 처럼 싸피아에서도 똑같은 체험을 할 수 있습니다.

- 투표기능
  - 투표하고 싶은 사람을 클릭하면 투표하실 수 있습니다.
  - 제한시간 안에는 투표를 바꿀수도 있고 취소할 수 있습니다.
  - 더 이상 바꿀 마음이 없다면 투표확정 버튼을 클릭해 확정할 수 있습니다.

![밤-관전자](https://user-images.githubusercontent.com/24693833/130017105-4a5eb94c-831e-404f-b7e9-be0395c28836.gif)

- 관전기능
  - 사망 시, 아무 역할 없이 게임이 진행되는 것을 보기만 하는 것이 아니라, 다른 사람들의 직업이 무엇인지 무슨 얘기를 하고 있는지 들을 수 있습니다.
- 비디오 온오프 기능
  - 진짜 모여서 마피아를 하는 것처럼 밤이 되면 다른 사람의 영상이나 오디오를 듣지 못하게 되고, 특정 사람들끼리만 확인할 수 있도록 됩니다.

<br>


## ⚙️ 기술 스택 

<img src="./img/tech-stack-and-service-architecture.png" width="640">


- frontend
  - vue 3.1.5
  - vuex 4.0.2
  - vue-router 4.0.10
  - sockjs-client 1.5.1, webstomp-client 1.2.6
- backend
  - MariaDB 10.4.20
  - redis 6.2.4
  - spring Boot 2.5.2
- 화상미팅 관련
  - openvidu-browser 2.19.0
  - openvidu 2.19.0
- 배포
  - aws
  - nginx

<br>

## 🏑 conventionss
### commit message convention
- algular commit message convention 
  - type(scope): short summary
  - type 종류
    - feat : 새로운 기능 추가
    - fix : 버그 수정
    - docs : 문서 관련
    - style : 스타일 변경 (포매팅 수정, 들여쓰기 추가, …)
    - refactor : 코드 리팩토링
    - test : 테스트 관련 코드
    - build : 빌드 관련 파일 수정
    - ci : CI 설정 파일 수정
    - perf : 성능 개선
  - short summary
    - 마침표 쓰지 않기
    - 한글 영문, 모두 가능

### git branch convention

- master - develop - feature
- 개인 개발한 것들은 모두 feature/기능 브랜치에서 수행
- 프론트와 백에서 asignee로 지명된 이들이 심사후 develop으로 merge
- master에 merge할 경우 팀원 모두 모여서 회의 후 진행


<br>

## 🌐 배포 방법
[frontend/src/constant/prod.js](./frontend/src/constant/prod.js)에서 올바른 도메인 이름으로 변경합니다.

WebRTC를 사용하기 때문에 STUN/TURN 서버가 필요합니다.

오픈 소스 프로젝트인 [coturn](https://github.com/coturn/coturn)을 설치하는 방법은 다음과 같습니다
```sh
sudo apt-get update && sudo apt-get install --no-install-recommends --yes coturn
```

`/etc/default/coturn`의 내용을 다음과 같이 수정합니다.
```sh
TURNSERVER_ENABLED=1
```

`/etc/turnserver.conf`의 내용을 다음과 같이 수정합니다.
```sh
listening-port=3478
tls-listening-port=5349
listening-ip=<EC2의 프라이빗 IPv4 주소>
external-ip=<EC2의 퍼블릭 IPv4 주소>/<EC2의 프라이빗 IPv4 주소>
relay-ip=<EC2의 프라이빗 IPv4 주소>
fingerprint
lt-cred-mech
user=myuser:mypassword
realm=myrealm
log-file=/var/log/turn.log
simple-log
```

coturn을 재기동합니다.
```
sudo service coturn restart
```

다음 명령어를 통해 coturn의 상태를 확인할 수 있습니다.
```
sudo systemctl status coturn
```

배포를 하기 위해서는 서버에 docker와 docker-compose가 설치되어 있어야 합니다.  
docker는 [공식 웹페이지에 나와 있는 debian에서의 설치 방법](https://docs.docker.com/engine/install/debian/#install-using-the-repository)으로 설치하면 되고, docker-compose는 apt-get 명령어를 통해 설치가 가능합니다.

프로젝트의 root 위치에서 docker-compose를 실행하면 빌드 및 배포까지 자동으로 이루어집니다.
```sh
docker-compose up -d
```

단, docker-compose를 실행하기 위해서는 `prod.env` 파일이 필요합니다. `prod.env`의 내용은 다음과 같습니다.
```env
# backend
GOOGLE_CLIENT_ID=1q2w3e4r-1q2w3e4r.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=4r3e2w1q4r3e2w1q
SPRING_DATASOURCE_USERNAME=a104
SPRING_DATASOURCE_PASSWORD=a1041234
JWT_SECRET=1q2w3e4r
#OPENVIDU_URL=https://<service domain name>:3333/
OPENVIDU_URL=https://openvidu:3333/
APP_BASE_URL=https://<service domain name>

# openvidu
KMS_STUN_IP=<coturn server ip>
KMS_STUN_PORT=3478
KMS_TURN_URL=myuser:mypassword@<coturn server ip>:3478?transport=udp
DOMAIN_OR_PUBLIC_IP=<service domain name>

# backend & openvidu
OPENVIDU_SECRET=MY_SECRET

# mysql
MYSQL_USER=a104
MYSQL_PASSWORD=a1041234
MYSQL_ROOT_PASSWORD=a1041234
```

### 첫 배포시 주의 사항
첫 배포시에는 [init-letsencrypt.sh](./init-letsencrypt.sh)을 실행시켜 certbot에 의해 SSL/TLS 인증서를 생성하도록 해야 합니다.

init-letsencrypt.sh 내용에서 `domains`와 `data_path`, `email`을 알맞게 수정한 뒤 실행시키면 됩니다.


### 배포시 주의 사항
redis/redis-data와 mysql/mysql-data는 각각 redis container와 mysql(mariadb) container의 데이터 저장 directory를 mount하고 있으니 각별히 주의해야 합니다.
